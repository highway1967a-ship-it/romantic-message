<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Couple's Message Room</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      background: linear-gradient(135deg, #ffe0ec 0%, #c9e4ff 100%);
      font-family: 'Segoe UI', Arial, sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .container {
      background: #fff0f6;
      border-radius: 20px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.08);
      width: 370px;
      max-width: 98vw;
      display: flex;
      flex-direction: column;
      padding: 28px 18px 18px 18px;
      position: relative;
    }
    .title {
      font-size: 1.5em;
      color: #d72660;
      font-weight: bold;
      text-align: center;
      margin-bottom: 10px;
    }
    .heart {
      color: #ff6f91;
      font-size: 2em;
      text-align: center;
      margin-bottom: 8px;
      animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.15); }
      100% { transform: scale(1); }
    }
    .room-form, .message-form {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 18px;
    }
    .room-input, .message-input {
      padding: 12px;
      border-radius: 12px;
      border: 1px solid #fbb1b1;
      font-size: 1em;
      outline: none;
      background: #fff;
    }
    .room-btn, .send-btn {
      background: linear-gradient(90deg, #ffb6b9 0%, #fbb1b1 100%);
      color: #fff;
      border: none;
      border-radius: 16px;
      padding: 10px 0;
      font-size: 1em;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s, transform 0.2s;
    }
    .room-btn:hover, .send-btn:hover {
      background: #d72660;
      transform: scale(1.04);
    }
    .messages {
      background: #fff;
      border-radius: 12px;
      min-height: 120px;
      max-height: 260px;
      overflow-y: auto;
      padding: 12px 8px;
      margin-bottom: 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      box-shadow: 0 1px 6px rgba(255,182,193,0.08);
    }
    .msg {
      max-width: 80%;
      padding: 8px 12px;
      border-radius: 14px;
      font-size: 1em;
      line-height: 1.5;
      word-break: break-word;
      position: relative;
      background: #ffe0ec;
      color: #b23a48;
      align-self: flex-start;
      box-shadow: 0 1px 4px rgba(255,182,193,0.08);
    }
    .msg.me {
      background: #c9e4ff;
      color: #333;
      align-self: flex-end;
    }
    .msg .meta {
      font-size: 0.8em;
      color: #b23a48;
      opacity: 0.7;
      margin-top: 2px;
      text-align: right;
    }
    .message-form {
      flex-direction: row;
      gap: 6px;
    }
    .message-input {
      flex: 1;
    }
    .send-btn {
      padding: 0 18px;
    }
    .logout-btn {
      position: absolute;
      top: 12px;
      right: 16px;
      background: #fff6e9;
      color: #d72660;
      border: 1px solid #fbb1b1;
      border-radius: 12px;
      padding: 4px 12px;
      font-size: 0.95em;
      cursor: pointer;
      transition: background 0.2s;
    }
    .logout-btn:hover {
      background: #ffe0ec;
    }
    @media (max-width: 600px) {
      .container {
        padding: 10px 2vw 18px 2vw;
        max-width: 99vw;
      }
      .title {
        font-size: 1.1em;
      }
      .messages {
        min-height: 80px;
        max-height: 180px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="heart">ðŸ’ž</div>
    <div class="title">Couple's Message Room</div>
    <form class="room-form" id="roomForm">
      <input class="room-input" id="roomCode" placeholder="Enter your couple code" required maxlength="20" />
      <input class="room-input" id="yourName" placeholder="Your name or nickname" required maxlength="20" />
      <button class="room-btn" type="submit">Enter Room</button>
    </form>
    <button class="logout-btn" id="logoutBtn" style="display:none">Logout</button>
    <div class="messages" id="messages" style="display:none"></div>
    <form class="message-form" id="messageForm" style="display:none">
      <input class="message-input" id="messageInput" placeholder="Type your message..." maxlength="300" required />
      <button class="send-btn" type="submit">Send</button>
    </form>
  </div>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script>
    // 1. Paste your Firebase config here (from Firebase Console > Project Settings > Web App)
    const firebaseConfig = {
      apiKey: "PASTE_YOUR_API_KEY",
      authDomain: "PASTE_YOUR_AUTH_DOMAIN",
      projectId: "PASTE_YOUR_PROJECT_ID",
      storageBucket: "PASTE_YOUR_STORAGE_BUCKET",
      messagingSenderId: "PASTE_YOUR_MESSAGING_SENDER_ID",
      appId: "PASTE_YOUR_APP_ID"
    };
    // 2. Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // --- DOM Elements ---
    const roomForm = document.getElementById('roomForm');
    const roomCodeInput = document.getElementById('roomCode');
    const yourNameInput = document.getElementById('yourName');
    const messagesDiv = document.getElementById('messages');
    const messageForm = document.getElementById('messageForm');
    const messageInput = document.getElementById('messageInput');
    const logoutBtn = document.getElementById('logoutBtn');

    let roomCode = '';
    let yourName = '';
    let unsubscribe = null;

    // --- Enter Room ---
    roomForm.addEventListener('submit', function(e) {
      e.preventDefault();
      roomCode = roomCodeInput.value.trim();
      yourName = yourNameInput.value.trim();
      if (!roomCode || !yourName) return;
      roomForm.style.display = 'none';
      messagesDiv.style.display = 'flex';
      messageForm.style.display = 'flex';
      logoutBtn.style.display = 'block';
      listenForMessages();
    });

    // --- Logout ---
    logoutBtn.addEventListener('click', function() {
      if (unsubscribe) unsubscribe();
      messagesDiv.innerHTML = '';
      messagesDiv.style.display = 'none';
      messageForm.style.display = 'none';
      logoutBtn.style.display = 'none';
      roomForm.style.display = 'flex';
      roomCodeInput.value = '';
      yourNameInput.value = '';
      roomCode = '';
      yourName = '';
    });

    // --- Send Message ---
    messageForm.addEventListener('submit', function(e) {
      e.preventDefault();
      const text = messageInput.value.trim();
      if (!text) return;
      db.collection('coupleRooms').doc(roomCode).collection('messages').add({
        name: yourName,
        text: text,
        time: Date.now()
      });
      messageInput.value = '';
    });

    // --- Listen for Messages ---
    function listenForMessages() {
      if (unsubscribe) unsubscribe();
      unsubscribe = db.collection('coupleRooms').doc(roomCode)
        .collection('messages').orderBy('time')
        .onSnapshot(snapshot => {
          messagesDiv.innerHTML = '';
          snapshot.forEach(doc => {
            const msg = doc.data();
            const msgDiv = document.createElement('div');
            msgDiv.className = 'msg' + (msg.name === yourName ? ' me' : '');
            msgDiv.innerHTML = `<b>${escapeHTML(msg.name)}</b>: ${escapeHTML(msg.text)}<div class="meta">${formatTime(msg.time)}</div>`;
            messagesDiv.appendChild(msgDiv);
          });
          messagesDiv.scrollTop = messagesDiv.scrollHeight;
        });
    }

    // --- Helpers ---
    function formatTime(ts) {
      const d = new Date(ts);
      return d.toLocaleString([], {dateStyle:'short', timeStyle:'short'});
    }
    function escapeHTML(str) {
      return str.replace(/[&<>"']/g, function(tag) {
        const chars = {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'};
        return chars[tag] || tag;
      });
    }
  </script>
  <!--
    HOW TO USE:
    1. Go to https://console.firebase.google.com/ and create a new project (free tier is fine)
    2. In the project, click Firestore Database > Create database (start in test mode)
    3. Go to Project Settings > Add app > Web, and copy the config into firebaseConfig above
    4. Open this HTML file in your browser (on phone or PC)
    5. Enter a shared code (e.g. "us2026") and your name. Share the code with your partner!
    6. Both can send/read messages in real time, from anywhere.
  -->
</body>
</html>
